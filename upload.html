<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GA Bulk Upload (Admin)</title>

  <style>
    * { box-sizing: border-box; font-family: Arial, sans-serif; }
    body { margin: 0; background: #f2f5fb; }
    header {
      background: linear-gradient(90deg, #0b2b66, #1e63c7);
      color: white;
      padding: 18px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
    }
    .wrap { max-width: 900px; margin: 18px auto; padding: 12px; }
    .card {
      background: white;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
      margin-bottom: 14px;
    }
    .hint {
      background: #eef5ff;
      border-left: 6px solid #1e63c7;
      padding: 12px;
      border-radius: 12px;
      font-size: 14px;
      color: #1a2a44;
    }
    textarea {
      width: 100%;
      min-height: 260px;
      border-radius: 14px;
      border: 1px solid #d9e2f1;
      padding: 12px;
      font-size: 14px;
      outline: none;
      resize: vertical;
    }
    .btns { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 12px; }
    button {
      border: none;
      padding: 12px 16px;
      border-radius: 14px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
    }
    .primary { background: #1e63c7; color: white; }
    .secondary { background: #0b1b33; color: white; }
    .danger { background: #b00020; color: white; }
    .status {
      margin-top: 10px;
      font-weight: bold;
      font-size: 14px;
    }
    .ok { color: #0b7a2a; }
    .err { color: #b00020; }
    .small { font-size: 12px; color: #666; margin-top: 6px; }
  </style>
</head>

<body>
  <header>GA Bulk Upload (Admin)</header>

  <div class="wrap">
    <div class="card">
      <div class="hint">
        <b>Instructions</b><br><br>
        1) Paste JSON array below<br>
        2) Click <b>Upload to Firebase</b><br>
        3) It will add docs into Firestore collection: <b>questions</b><br><br>
        <span class="small">
          Format required:
          <code>[{"subject":"GA","topic":"Percentages","question":"...","options":["A","B","C","D"],"answer":0}]</code>
        </span>
      </div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 10px;">Paste Questions JSON</h3>
      <textarea id="jsonInput">[
  {
    "subject": "GA",
    "topic": "Percentages",
    "question": "A value increases from 200 to 250. Percentage increase is?",
    "options": ["10%", "20%", "25%", "50%"],
    "answer": 2
  }
]</textarea>

      <div class="btns">
        <button class="primary" id="uploadBtn">Upload to Firebase</button>
        <button class="secondary" onclick="location.href='./index.html'">Back to App</button>
        <button class="danger" id="clearBtn">Clear Box</button>
      </div>

      <div id="status" class="status"></div>
    </div>
  </div>

  <!-- Firebase SDK (Compat) - Works in plain HTML -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // ✅ Your Firebase Config (Correct)
    const firebaseConfig = {
      apiKey: "AIzaSyC_f6lvDO9LeSE22kv4HIhWLj846bmRla8",
      authDomain: "gate-ec-mock.firebaseapp.com",
      projectId: "gate-ec-mock",
      storageBucket: "gate-ec-mock.firebasestorage.app",
      messagingSenderId: "668980846025",
      appId: "1:668980846025:web:a960f983f2e6311fad1c18"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const jsonInput = document.getElementById("jsonInput");
    const statusEl = document.getElementById("status");
    const uploadBtn = document.getElementById("uploadBtn");
    const clearBtn = document.getElementById("clearBtn");

    function setStatus(msg, type="ok") {
      statusEl.className = "status " + (type === "ok" ? "ok" : "err");
      statusEl.innerText = msg;
    }

    clearBtn.addEventListener("click", () => {
      jsonInput.value = "";
      setStatus("Cleared JSON box.", "ok");
    });

    uploadBtn.addEventListener("click", async () => {
      try {
        const raw = jsonInput.value.trim();
        if (!raw) {
          setStatus("❌ Paste JSON first!", "err");
          return;
        }

        let data;
        try {
          data = JSON.parse(raw);
        } catch (e) {
          setStatus("❌ Invalid JSON: " + e.message, "err");
          return;
        }

        if (!Array.isArray(data)) {
          setStatus("❌ JSON must be an ARRAY [ ... ]", "err");
          return;
        }

        if (data.length === 0) {
          setStatus("❌ JSON array is empty!", "err");
          return;
        }

        // Validate each question
        for (let i = 0; i < data.length; i++) {
          const q = data[i];

          if (!q.subject || !q.topic || !q.question || !q.options || q.answer === undefined) {
            setStatus(`❌ Missing fields in item ${i+1}. Required: subject, topic, question, options, answer`, "err");
            return;
          }

          if (!Array.isArray(q.options) || q.options.length !== 4) {
            setStatus(`❌ Item ${i+1}: options must be array of 4 strings`, "err");
            return;
          }

          if (typeof q.answer !== "number" || q.answer < 0 || q.answer > 3) {
            setStatus(`❌ Item ${i+1}: answer must be number 0/1/2/3`, "err");
            return;
          }
        }

        setStatus("⏳ Uploading... please wait...", "ok");

        let added = 0;

        // Upload one-by-one (safe & stable)
        for (const q of data) {
          await db.collection("questions").add({
            subject: q.subject,
            topic: q.topic,
            question: q.question,
            options: q.options,
            answer: q.answer,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          added++;
        }

        setStatus(`✅ Upload Success! Added ${added} questions to Firestore`, "ok");

      } catch (err) {
        console.error(err);
        setStatus("❌ Upload failed: " + err.message, "err");
      }
    });
  </script>
</body>
</html>